!function(e){var t={};function n(l){if(t[l])return t[l].exports;var r=t[l]={i:l,l:!1,exports:{}};return e[l].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(l,r,function(t){return e[t]}.bind(null,r));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){if(window.Funnelback||(window.Funnelback={}),!Handlebars)throw new Error("Handlebars must be included (https://handlebarsjs.com/)");window.Funnelback.Handlebars||(window.Funnelback.Handlebars=Handlebars.create()),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),n=t.length,l=new Array(n);n--;)l[n]=[t[n],e[t[n]]];return l}),window.Funnelback.SessionCart=function(){"use strict";var e=function(e){return this.init(e)};e.defaults={apiBase:"/s/cart.json",collection:null,iconPrefix:"glyphicon glyphicon-",cart:{selector:"#search-cart",pageSelector:["#search-results-content","#search-history"],icon:"pushpin",label:"Saved",backIcon:"arrow-left",backLabel:"Back to results",clearClasses:"btn btn-xs btn-danger",clearIcon:"remove",clearLabel:"Clear",templateSelector:"#cart-template",emptyMessage:'<span id="flb-cart-empty-message">No items</span>'},cartCount:{selector:".flb-cart-count",icon:"shopping-cart",isLabel:!1,label:"cart",template:"{{>icon-block}} {{>label-block}} {{>badge-block}}"},item:{selector:"#search-results",templates:{default:'<h4><a href="{{indexUrl}}">{{#truncate 70}}{{title}}{{/truncate}}</a></h4><cite class="text-success">{{#cut "https://"}}{{indexUrl}}{{/cut}}</cite><p>{{#truncate 255}}{{summary}}{{/truncate}}</p>'},class:""},itemTrigger:{selector:"h4",position:"afterbegin",class:"",iconAdd:"pushpin",iconDelete:"remove",isLabel:!1,labelAdd:"Add to cart",labelDelete:"Remove from cart",template:"{{>icon-block}} {{>label-block}}"},cartItemTrigger:{},resultItemTrigger:{}},e.prototype.Handlebars=window.Funnelback.Handlebars,e.prototype.init=function(i){return i.collection?((e.options=c.extend(e.defaults,i||{})).cart.pageSelector||(e.options.cart.pageSelector=[]),e.options.cartItemTrigger=c.extend(c.extend({},e.options.itemTrigger),e.options.cartItemTrigger),e.options.resultItemTrigger=c.extend(c.extend({},e.options.itemTrigger),e.options.resultItemTrigger),n.init(e.options),l.init(e.options),r.init(e.options),a.init(e.options),o.set(e.options),t.get(e.options).then((function(t){o.update(e.options,t.data),l.set(t.data.length),n.toggleClearElement(t.data)})).catch((function(e){console.error("Something went wrong and no data was fetched. Try again later..",e)})),this):(console.error('Missing "collection" parameter'),null)},e.prototype.clear=function(){if(!0===confirm("Your selection will be cleared")){var r=this.getOption();t.delete(r).then((function(t){o.clear(r),l.set(t.data.length),n.toggleClearElement(t.data),e.prototype.hide()})).catch((function(e){console.error("Something went wrong and cart was not cleared. Try again later..",e)}))}return this},e.prototype.destroy=function(){return e.options={},null},e.prototype.show=function(){return n.element.style.display="block",n.togglePageElements("none"),n.isHidden=!1,this},e.prototype.hide=function(){return n.element.style.display="none",n.togglePageElements("block"),n.isHidden=!0,this},e.prototype.toggle=function(){return n.isHidden?e.prototype.show():e.prototype.hide()},e.prototype.getOption=function(t){return 0===arguments.length?e.options:"string"==typeof t?e.options[t]:void 0},e.prototype.addItem=function(e){var o=this.getOption();t.post(o,{url:e}).then((function(t){r.update(o,t.data.filter((function(t){return t.indexUrl===e}))[0],"del"),l.set(t.data.length),n.toggleClearElement(t.data)})).catch((function(e){console.error("Something went wrong and item was not saved in a cart. Try again later..",e)}))},e.prototype.deleteItem=function(e){var o=this.getOption();t.delete(o,{url:e}).then((function(t){r.update(o,{indexUrl:e},"add"),l.set(t.data.length),n.toggleClearElement(t.data)})).catch((function(e){console.error("Something went wrong and result was not removed from a cart. Try again later..",e)}))};var t={delete:function(e,n){return t.request("delete",e,n)},get:function(e,n){return t.request("get",e,n)},post:function(e,n){return t.request("post",e,n)},request:function(e,n,l){return new Promise((function(r,o){var a=new XMLHttpRequest,i=t.getUrl(n,l);a.withCredentials=!0,a.onload=function(){if(200!==this.status)o({url:i,error:this});else try{var e=JSON.parse(this.responseText);r({url:i,data:e})}catch(e){o({url:i,error:e})}},a.onerror=function(){o({url:i,error:a})},a.open(e,i,!0),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","text/plain"),a.send(JSON.stringify(l||{}))}))},getParamsString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},getUrl:function(e,n){return n||(n={}),n.collection=e.collection,e.apiBase+"?"+t.getParamsString(n)}},n={element:null,clearElement:null,listElement:null,pageElements:[],modifiedPageElements:null,isHidden:!0,emptyMessage:null,init:function(t){n.element=i.findOnce(t.cart.selector),n.element||console.warn('No element was found with provided selector "'.concat(t.cart.selector,'"')),n.element.style.display="none",n.emptyMessage=t.cart.emptyMessage;for(var l=0,r=t.cart.pageSelector.length;l<r;l++){var o=i.findOnce(t.cart.pageSelector[l]);o&&n.pageElements.push(o)}n.pageElements.length||console.warn('No element was found with provided page selector "'.concat(t.cart.pageSelector,'"'));var a=t.cart.backIcon?t.iconPrefix+t.cart.backIcon:null,c=t.cart.icon?t.iconPrefix+t.cart.icon:null,u=t.cart.clearIcon?t.iconPrefix+t.cart.clearIcon:null;document.querySelector(t.cart.templateSelector)||console.warn('No element was found with the provided selector "'.concat(t.cart.templateSelector,'"'));var d=s.compile(document.querySelector(t.cart.templateSelector).text);document.getElementById("search-cart").innerHTML=d({backIcon:a,headerIcon:c,clearIcon:u,backLabel:t.cart.backLabel,label:t.cart.label,clearLabel:t.cart.clearLabel}),n.clearElement=document.getElementById("flb-cart-box-clear"),n.clearElement.addEventListener("click",(function(){e.prototype.clear(t)})),document.getElementById("flb-cart-box-back").addEventListener("click",e.prototype.hide),n.listElement=document.getElementById("flb-cart-box-list")},toggleClearElement:function(e){e.length>0?n.clearElement.style.display="inline-block":(n.listElement.innerHTML=n.emptyMessage,n.clearElement.style.display="none")},togglePageElements:function(e){n.modifiedPageElements&&"none"!==e||(n.modifiedPageElements=n.pageElements);for(var t=[],l=0,r=n.pageElements.length;l<r;l++){var o=n.pageElements[l];-1!==n.modifiedPageElements.indexOf(o)&&o.style.display!==e&&(o.style.display=e,t.push(o))}n.modifiedPageElements=t}},l={selector:"flb-cart-count-trigger",element:null,icon:null,label:null,partialTitle:" items",template:null,init:function(t){t.cartCount.icon&&(l.icon=t.iconPrefix+t.cartCount.icon),t.cartCount.isLabel&&(l.label=t.cartCount.label),t.cartCount.label&&(l.partialTitle+=" in your "+t.cartCount.label.toLowerCase()),l.template=s.compile(t.cartCount.template),l.element=i.create(l.selector,i.findOnce(t.cartCount.selector),"button",l.template(l.data(0)),{class:"btn-link",type:"button",tabindex:"0",title:l.title(0)}),i.addEvent(l.element,"click",e.prototype.toggle)},data:function(e){return{count:e,icon:l.icon,label:l.label}},set:function(e){i.setContent(l.element,l.template(l.data(e))),l.element.setAttribute("title",l.title(e)),l.element.closest("button").disabled=0===e},title:function(e){return e+l.partialTitle}},r={selectorAttr:"data-fb-result",listElement:null,templates:null,init:function(e){r.templates=Object.entries(e.item.templates).reduce((function(e,t){var[n,l]=t;return e[n]=s.compile(l),e}),{}),r.listElement=i.findOnce(e.item.selector),r.listElement||console.warn('No element was found with provided selector "'+e.item.selector+'"')},selector:function(e){return e?"["+r.selectorAttr+'="'+e+'"]':"["+r.selectorAttr+"]"},update:function(e,t,l){var o=i.findOnce(r.selector(t.indexUrl),r.listElement);if(o&&a.update("result",o,l),"add"===l){var c=i.findOnce(r.selector(t.indexUrl),n.listElement);i.remove(c)}else{var s={};e.item.class&&(s.class=e.item.class),s[r.selectorAttr]=t.indexUrl;var u=r.templates[t.collection]?r.templates[t.collection]:r.templates.default,d=i.create("flb-cart-box-item",null,"li",u(t),s);a.set("cart",e.cartItemTrigger,d),a.update("cart",d);var p=document.getElementById("flb-cart-empty-message");p&&p.parentNode.removeChild(p),n.listElement.insertAdjacentElement("afterbegin",d)}}},o={clear:function(e){n.listElement.innerHTML=n.emptyMessage;for(var t=i.find(r.selector(),r.listElement),l=0,o=t.length;l<o;l++)a.update("result",t[l],"add")},set:function(e){for(var t=i.find(r.selector(),r.listElement),n=t.length-1;n>=0;n--)a.set("result",e.resultItemTrigger,t[n])},update:function(e,t,l){for(var o=0,a=t.length;o<a;o++)r.update(e,t[o],l);t.length||(n.listElement.innerHTML=n.emptyMessage)}},a={selector:"flb-cart-item-trigger",addEvent:null,delEvent:null,cartAddTemplate:null,cartAddTitle:null,cartDelTemplate:null,cartDelTitle:null,resultAddTemplate:null,resultAddTitle:null,resultDelTemplate:null,resultDelTitle:null,init:function(t){function n(e,n){var l=s.compile(n.template);a[e+"AddTemplate"]=l({icon:t.iconPrefix+n.iconAdd,label:n.isLabel?n.labelAdd:null}),a[e+"DelTemplate"]=l({icon:t.iconPrefix+n.iconDelete,label:n.isLabel?n.labelDelete:null}),a[e+"AddTitle"]=n.labelAdd,a[e+"DelTitle"]=n.labelDelete}n("cart",t.cartItemTrigger),n("result",t.resultItemTrigger),a.addEvent=function(t){t.preventDefault();var n=t.currentTarget.closest(r.selector()).getAttribute(r.selectorAttr);if(n)return e.prototype.addItem(n);console.warn("No URL found to save item in a cart")},a.delEvent=function(t){t.preventDefault();var n=t.currentTarget.closest(r.selector()).getAttribute(r.selectorAttr);if(n)return e.prototype.deleteItem(n);console.warn("No URL found to remove result from a cart")}},set:function(e,t,n){var l=i.findOnce(t.selector,n),r=i.create(a.selector,null,"button",a[e+"AddTemplate"],{class:t.class,title:a[e+"AddTitle"],type:"button",tabindex:"0"});i.addEvent(r,"click",a.addEvent),l?l.insertAdjacentElement(t.position,r):console.info('No element was found with provided selector "'+t.selector+'"')},update:function(e,t,n){var l=i.findOnce("."+a.selector,t);"add"===n?(i.setContent(l,a[e+"AddTemplate"]),i.removeEvent(l,"click",a.delEvent),i.addEvent(l,"click",a.addEvent),l.setAttribute("title",a[e+"AddTitle"])):(i.setContent(l,a[e+"DelTemplate"]),i.removeEvent(l,"click",a.addEvent),i.addEvent(l,"click",a.delEvent),l.setAttribute("title",a[e+"DelTitle"]))}},i={create:function(e,t,n,l,r){var o=document.createElement(n||"div");return l&&i.setContent(o,l),r||(r={}),r.class?r.class+=" "+e:r.class=e,i.setAttr(o,r),t&&t.appendChild(o),o},remove:function(e){e?e.parentNode.removeChild(e):console.warn("Remove called on element which could not be found")},find:function(e,t){return t||(t=document),t.querySelectorAll(e)},findOnce:function(e,t){return i.find(e,t)[0]},setAttr:function(e,t){for(var n=Object.entries(t),l=0,r=n.length;l<r;l++)e.setAttribute(n[l][0],n[l][1])},setContent:function(e,t){e.innerHTML=t},addEvent:function(e,t,n){e.addEventListener(t,n)},removeEvent:function(e,t,n){e.removeEventListener(t,n)}},c={extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]="object"==typeof t[n]?c.extend(e[n]||{},t[n]):t[n]);return e}},s={compile:function(t){return e.prototype.Handlebars.compile(t)},registerPartial:function(t){for(var n=Object.entries(t),l=0,r=n.length;l<r;l++)e.prototype.Handlebars.registerPartial(n[l][0]+"-block",n[l][1])}};return s.registerPartial({badge:'<span class="badge">{{count}}</span>',icon:'{{#if icon}}<span class="{{icon}} {{classes}} flb-cart-icon"></span>{{/if}}',label:"{{#if label}}{{label}}{{/if}}"}),e}()}]);