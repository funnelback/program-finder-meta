{"version":3,"file":"js/Credits-6bc69e3f3b7248b03f03.js","mappings":"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","sources":["webpack://Plug-and-Play-Template/./src/modules/edify-credits/jsx/creditBalance.jsx","webpack://Plug-and-Play-Template/./src/modules/edify-credits/jsx/credits.jsx","webpack://Plug-and-Play-Template/./src/modules/popover/jsx/popover.jsx"],"sourcesContent":["import React from 'react';\nimport { format } from 'date-fns';\n\nimport WidgetItem from 'Edify/jsx/WidgetItem';\n\nexport default function CreditBalance({\n    balances,\n    transactions,\n    type,\n    label,\n    lowThreshold,\n    showRecentTransactions,\n    addCreditLink,\n    allTransactionsLink,\n    closeModal,\n    popover,\n}) {\n    const typeBalance = balances[type] || 'NaN';\n    const typeTransactions = showRecentTransactions\n        ? transactions[type] || []\n        : [];\n    const lowBalance = parseFloat(typeBalance) < lowThreshold;\n\n    // Create our number formatter.\n    const currencyFormatter = new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: 'USD',\n    });\n\n    const creditBalance = (\n        <div\n            className={`credit-balance ${\n                !popover ? 'credit-balance--standalone' : ''\n            }`}\n        >\n            {popover && (\n                <div className=\"credit-balance__header\">\n                    {`${label} Balance`}{' '}\n                    <button\n                        className=\"credit-balance__header-button\"\n                        type=\"button\"\n                        onClick={closeModal}\n                    >\n                        <span className=\"sr-only\">Close</span>\n                        <svg className=\"credit-balance__header-button-icon\">\n                            <use href=\"#close\" />\n                        </svg>\n                    </button>\n                </div>\n            )}\n            <div\n                className={`credit-balance__balance ${\n                    lowBalance ? 'credit-balance__balance--low' : ''\n                }`}\n            >\n                <div className=\"credit-balance__balance-amount\">\n                    {currencyFormatter.format(typeBalance)}\n                    {lowBalance && (\n                        <div className=\"credit-balance__balance-amount-low\">\n                            <svg className=\"svg-icon svg-icon--small\">\n                                <title>Warning</title>\n                                <use href=\"#warning\" />\n                            </svg>\n                            Low balance\n                        </div>\n                    )}\n                </div>\n                {addCreditLink && (\n                    <a\n                        href={addCreditLink}\n                        className=\"credit-balance__balance-add\"\n                    >\n                        <svg aria-hidden className=\"svg-icon svg-icon--small\">\n                            <use href=\"#add-alt\" />\n                        </svg>\n                        Add more balance\n                    </a>\n                )}\n            </div>\n            {showRecentTransactions && typeTransactions.length > 0 && (\n                <div className=\"credit-balance__transactions\">\n                    <ul className=\"credit-balance__transactions-list\">\n                        {typeTransactions.map(\n                            ({ id, label: transactionlabel, amount, date }) => {\n                                return (\n                                    <li key={id} className=\"credit-transaction\">\n                                        <div className=\"credit-transaction__details\">\n                                            <div className=\"credit-transaction__label\">\n                                                {transactionlabel}\n                                            </div>\n                                            {date && (\n                                                <div className=\"credit-transaction__date\">\n                                                    {format(\n                                                        date,\n                                                        'dd MMM, yyyy, h:mmaaa'\n                                                    )}\n                                                </div>\n                                            )}\n                                        </div>\n                                        <div className=\"credit-transaction__amount\">\n                                            {currencyFormatter.format(amount)}\n                                        </div>\n                                    </li>\n                                );\n                            }\n                        )}\n                    </ul>\n                    {allTransactionsLink && (\n                        <a\n                            href={allTransactionsLink}\n                            className=\"credit-balance__all-transactions\"\n                        >\n                            <svg className=\"svg-icon svg-icon--small\">\n                                <title>External link</title>\n                                <use href=\"#external\" />\n                            </svg>\n                            See all transactions\n                        </a>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n\n    if (popover) {\n        return creditBalance;\n    }\n\n    return (\n        <WidgetItem title={`${label} Balance`} scrollable>\n            {creditBalance}\n        </WidgetItem>\n    );\n}\n","/* eslint-disable react/prefer-stateless-function */\nimport React, { useContext, useEffect } from 'react';\nimport uuidv4 from 'PlugAndPlay/_global/js/uuid';\nimport { watchModals } from '@react-aria/aria-modal-polyfill';\nimport { OverlayProvider } from '@react-aria/overlays';\n\nimport CreditContext from './data/CreditContext';\nimport Popover from '../../popover/jsx/popover';\n\nimport CreditBalance from './creditBalance';\n\n/**\n * Credits Application\n */\nexport default function Credits({\n    popover = false,\n    summaryMode = false,\n    balanceTypes,\n}) {\n    const { balances, getBalances, transactions, getTransactions } =\n        useContext(CreditContext);\n\n    // Initial data load\n    useEffect(() => {\n        // Get the balances for the types the app has been configured to display\n        getBalances(balanceTypes.map((balanceType) => balanceType.type));\n    }, [balanceTypes]);\n\n    // Initial data load\n    useEffect(() => {\n        if (!summaryMode) {\n            // Get the balances for the types the app has been configured to display\n            // But filter down to only those types that have been configured to show the recent transactions\n            getTransactions(\n                balanceTypes\n                    .filter((balanceType) => balanceType.showRecentTransactions)\n                    .map((balanceType) => balanceType.type)\n            );\n        }\n    }, [summaryMode, balanceTypes]);\n\n    watchModals();\n\n    if (popover) {\n        return (\n            <OverlayProvider className=\"no-wysiwyg credits-wrapper\">\n                {balanceTypes.map((balanceConfig) => {\n                    // If in popover mode, wrap it in a Popover object\n                    if (popover) {\n                        const titleId = uuidv4(); // Popover needs a id for the dialog described by\n\n                        return (\n                            <Popover\n                                key={balanceConfig.type}\n                                titleId={titleId}\n                                trigger={({ props, ref }) => {\n                                    return (\n                                        <button\n                                            ref={ref}\n                                            {...props}\n                                            type=\"button\"\n                                            className=\"credits-wrapper__action\"\n                                        >\n                                            <svg className=\"svg-icon\">\n                                                <title>\n                                                    {`View ${balanceConfig.type} balance`}\n                                                </title>\n                                                <use\n                                                    href={`#${balanceConfig.icon}`}\n                                                />\n                                            </svg>\n                                        </button>\n                                    );\n                                }}\n                                className=\"credits-popover\"\n                            >\n                                <CreditBalance\n                                    popover\n                                    {...balanceConfig}\n                                    balances={balances}\n                                    transactions={transactions}\n                                />\n                            </Popover>\n                        );\n                    }\n\n                    // Else return just the content\n                    return (\n                        <CreditBalance\n                            popover={false}\n                            key={balanceConfig.type}\n                            {...balanceConfig}\n                            balances={balances}\n                            transactions={transactions}\n                        />\n                    );\n                })}\n            </OverlayProvider>\n        );\n    }\n\n    return (\n        <div className=\"no-wysiwyg credits-wrapper credits-wrapper--standalone\">\n            {balanceTypes.map((balanceConfig) => {\n                // Else return just the content\n                return (\n                    <CreditBalance\n                        popover={false}\n                        key={balanceConfig.type}\n                        {...balanceConfig}\n                        balances={balances}\n                        transactions={transactions}\n                    />\n                );\n            })}\n        </div>\n    );\n}\n","/* eslint-disable react/button-has-type */\n/* eslint-disable react/jsx-props-no-spreading */\nimport React, { useState, cloneElement } from 'react';\nimport PropTypes from 'prop-types';\n\nimport {\n    OverlayContainer,\n    DismissButton,\n    useOverlayTrigger,\n    useOverlayPosition,\n    useOverlay,\n    useModal,\n} from '@react-aria/overlays';\nimport { useButton } from '@react-aria/button';\nimport { useDialog } from '@react-aria/dialog';\nimport { FocusScope } from '@react-aria/focus';\nimport { mergeProps } from '@react-aria/utils';\n\nconst OTHER_OVERLAY_CONTAINER_OPEN =\n    '[data-overlay-container]:not([aria-hidden=\"true\"])';\nconst AIRA_HIDDEN = '[aria-hidden=\"true\"]';\n\nconst PopoverContent = React.forwardRef(\n    (\n        {\n            triggerRef,\n            titleId,\n            title,\n            children,\n            isOpen,\n            onClose,\n            className,\n            ...otherProps\n        },\n        ref\n    ) => {\n        // Handle interacting outside the dialog and pressing the Escape key to close the modal.\n        const { overlayProps } = useOverlay(\n            {\n                onClose,\n                isOpen,\n                isDismissable: true,\n                shouldCloseOnInteractOutside: (element) => {\n                    /*\n                        Framework tries to cancels all events on the basis that there is an 'overlay' showing\n                        which should swallow the events, except it doesnt work consistently and will allow most\n                        onClick bound events though and only block other usage from the @react-aria framework\n                        like other popover openers.\n                    */\n\n                    // If content within the popover has cause ANOTHER overlay to open we dont want to close\n                    // this one just because its being interacted with somehow.\n                    if (\n                        element.closest(OTHER_OVERLAY_CONTAINER_OPEN) &&\n                        !element.closest(AIRA_HIDDEN)\n                    ) {\n                        return false;\n                    }\n\n                    // If the click is on the popover trigger just let it through so the popover doesnt re-open itself\n                    if (triggerRef.current.contains(element)) {\n                        return true;\n                    }\n\n                    onClose(); // Close the popover\n                    return false; // But let the click / press event cascade\n                },\n            },\n            ref\n        );\n\n        // Hide content outside the modal from screen readers.\n        const { modalProps } = useModal();\n\n        // Get props for the dialog and its title\n        const { dialogProps, titleProps } = useDialog(\n            { 'aria-describedby': titleId },\n            ref\n        );\n\n        return (\n            <FocusScope contain restoreFocus>\n                <div\n                    {...mergeProps(\n                        overlayProps,\n                        dialogProps,\n                        otherProps,\n                        modalProps\n                    )}\n                    ref={ref}\n                    className={`popover__dialog ${className}__dialog`}\n                >\n                    {/* Include a title only if a titleId is not provided */}\n                    {titleId ? (\n                        ''\n                    ) : (\n                        <h2\n                            {...titleProps}\n                            className={`popover__title ${className}__title`}\n                        >\n                            {title}\n                        </h2>\n                    )}\n\n                    {children}\n                    <DismissButton onDismiss={onClose} />\n                </div>\n            </FocusScope>\n        );\n    }\n);\n\n/**\n * Create an ARIA / WCAG compatable popover using @react-aria\n * Modified from: https://react-spectrum.adobe.com/react-aria/useOverlayTrigger.html\n *\n * @param {string} titleId - (optional) Id of an element in the children element to act as dialog title; if not provided 'title' must be.\n * @param {string} title - (optional) Title of the dialog; if not provided 'titleId' must be.\n * @param {function} trigger - Callback function to generate the trigger button for the popover\n * @param {string} className - Class to pre-pend to all internal className definitions\n * @param {string} children - Content of the Popover\n * @returns {JSX.Element}\n */\nexport default function Popover({\n    titleId,\n    title,\n    placement,\n    trigger,\n    className,\n    children,\n}) {\n    // Implementing useOverlayTriggerState so i dont have to add another dependency\n    const [isOpen, setIsOpen] = useState(false);\n\n    const triggerRef = React.useRef();\n    const overlayRef = React.useRef();\n\n    // Get props for the trigger and overlay. This also handles hiding the overlay when a parent element of the trigger scrolls (which invalidates the popover positioning).\n    const { triggerProps, overlayProps } = useOverlayTrigger(\n        { type: 'dialog' },\n        {\n            isOpen,\n        },\n        triggerRef\n    );\n\n    // Get popover positioning props relative to the trigger\n    const { overlayProps: positionProps } = useOverlayPosition({\n        targetRef: triggerRef,\n        overlayRef,\n        placement: placement || 'bottom right',\n        offset: 5,\n        isOpen,\n    });\n\n    // Let the CSS and template decide the correct z-index\n    delete positionProps.style.zIndex;\n\n    // Move properties into CSS variables to make altering them easier\n    // eslint-disable-next-line no-restricted-syntax\n    for (const [key, value] of Object.entries(positionProps.style)) {\n        // eslint-disable-next-line no-restricted-globals\n        positionProps.style[`--popover-${key}`] = !isNaN(value)\n            ? `${value}px`\n            : value;\n\n        delete positionProps.style[key];\n    }\n\n    const { buttonProps } = useButton(\n        {\n            onPress: () => setIsOpen(true),\n        },\n        triggerRef\n    );\n\n    // Get the trigger element from the parent\n    const triggerElement = trigger({\n        props: { ...mergeProps(buttonProps, triggerProps) },\n        ref: triggerRef,\n    });\n\n    return (\n        <>\n            {triggerElement}\n            {isOpen && (\n                <OverlayContainer className={`popover ${className}`}>\n                    <PopoverContent\n                        {...overlayProps}\n                        {...positionProps}\n                        ref={overlayRef}\n                        triggerRef={triggerRef}\n                        titleId={titleId}\n                        title={title}\n                        isOpen\n                        onClose={() => {\n                            setIsOpen(false);\n                        }}\n                        className={className}\n                    >\n                        {/* Clone the children so we can pass the closeModal function to them */}\n                        {cloneElement(children, {\n                            closeModal: () => setIsOpen(false),\n                        })}\n                    </PopoverContent>\n                </OverlayContainer>\n            )}\n        </>\n    );\n}\n\nPopover.propTypes = {\n    titleId: PropTypes.string,\n    title: PropTypes.string,\n    trigger: PropTypes.func,\n    className: PropTypes.string,\n};\n\nPopover.defaultProps = {\n    titleId: '',\n    title: 'popover',\n    trigger: ({ props, ref }) => {\n        return (\n            <button {...props} ref={ref}>\n                Open popover\n            </button>\n        );\n    },\n    className: 'popover',\n};\n"],"names":["CreditBalance","balances","transactions","type","label","lowThreshold","showRecentTransactions","addCreditLink","allTransactionsLink","closeModal","popover","typeBalance","typeTransactions","lowBalance","parseFloat","currencyFormatter","Intl","NumberFormat","style","currency","creditBalance","className","onClick","href","format","length","map","id","transactionlabel","amount","date","key","WidgetItem","title","scrollable","Credits","summaryMode","balanceTypes","getBalances","getTransactions","useContext","CreditContext","useEffect","balanceType","filter","watchModals","balanceConfig","titleId","uuidv4","trigger","props","ref","icon","PopoverContent","React","triggerRef","children","isOpen","onClose","otherProps","overlayProps","useOverlay","isDismissable","shouldCloseOnInteractOutside","element","closest","current","contains","modalProps","useModal","dialogProps","titleProps","useDialog","contain","restoreFocus","mergeProps","onDismiss","Popover","placement","setIsOpen","useState","overlayRef","triggerProps","useOverlayTrigger","positionProps","useOverlayPosition","targetRef","offset","zIndex","value","Object","entries","isNaN","buttonProps","useButton","onPress","triggerElement","cloneElement","propTypes","PropTypes","defaultProps"],"sourceRoot":""}